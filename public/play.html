<script>
    const socket = io();
    const mode = localStorage.getItem('gameMode') || 6;
    let myTurn = false;
    let hand = [['â™¥ï¸3','â™¥ï¸4','â™¥ï¸5'], ['â™£ï¸J','â™£ï¸Q','â™£ï¸K'], ['â™¦ï¸7','â™¦ï¸8','â™¦ï¸9'], ['â™ ï¸A','â™ ï¸2']];

    socket.emit('joinGame', { name: localStorage.getItem('name'), mode: mode });

    // Syncing Timer & Turn from Server
    socket.on('updateState', (data) => {
        document.getElementById('timer').innerText = data.timer;
        myTurn = (data.turn === 0);
        
        // Highlighting Active Player
        document.querySelectorAll('.player').forEach((p, idx) => {
            p.classList.remove('active-glow');
            if(idx === data.turn) p.classList.add('active-glow');
        });
        
        document.getElementById('status').innerText = myTurn ? "YOUR TURN!" : "WAITING FOR OTHERS...";
    });

    // Bot Animation Logic
    socket.on('botMove', (data) => {
        console.log("Bot " + data.botIndex + " is thinking...");
        // Simulating card pick and discard animation
        const openDeck = document.getElementById('opC');
        setTimeout(() => {
            openDeck.innerText = "ðŸƒ"; // Bot discarded a random card
            openDeck.style.transform = "scale(1.2)";
            setTimeout(() => openDeck.style.transform = "scale(1)", 200);
        }, 2000);
    });

    function discard(gIdx, cIdx) {
        if(!myTurn || hand.flat().length < 14) return;
        const c = hand[gIdx].splice(cIdx, 1);
        document.getElementById('opC').innerText = c[0];
        render();
        // Notify server turn finished (optional but good)
    }

    function render() {
        const h = document.getElementById('myHand'); h.innerHTML = '';
        hand.forEach((g, gIdx) => {
            const d = document.createElement('div'); d.className = 'card-group';
            g.forEach((c, cIdx) => {
                const cd = document.createElement('div'); cd.className = 'card';
                cd.style.color = (c.includes('â™¥ï¸') || c.includes('â™¦ï¸')) ? 'red' : 'black';
                cd.innerText = c; cd.onclick = () => discard(gIdx, cIdx);
                d.appendChild(cd);
            });
            h.appendChild(d);
        });
    }
    render();
</script>
