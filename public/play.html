<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Real Rummy Table</title>
<script src="/socket.io/socket.io.js"></script>

<style>
body{
    margin:0;
    background:radial-gradient(circle at top,#3b2a1a,#0b3d2e);
    font-family:sans-serif;
    color:white;
}

/* Top Bar */
.topbar{
    display:flex;
    justify-content:space-between;
    padding:10px 15px;
    background:#111;
    font-weight:bold;
}

/* Table Section */
.table-area{
    position:relative;
    height:55vh;
    display:flex;
    justify-content:center;
    align-items:center;
}

.table{
    width:90%;
    max-width:700px;
    height:260px;
    background:linear-gradient(145deg,#1e8449,#145a32);
    border-radius:180px;
    border:8px solid #b8860b;
    box-shadow:
        inset 0 0 40px rgba(0,0,0,0.7),
        0 0 30px rgba(255,215,0,0.3);
    position:relative;
}

/* Decks */
.deck{
    position:absolute;
    top:50%;
    transform:translateY(-50%);
    text-align:center;
}

.closed{
    left:20%;
}

.open{
    right:20%;
}

.deck-box{
    width:60px;
    height:85px;
    border-radius:8px;
    box-shadow:0 6px 10px rgba(0,0,0,0.5);
}

.closed .deck-box{
    background:#111;
}

.open .deck-box{
    background:white;
    color:black;
    font-weight:bold;
    font-size:22px;
    display:flex;
    align-items:center;
    justify-content:center;
}

/* Cards bottom */
.cards-area{
    position:fixed;
    bottom:90px;
    width:100%;
    text-align:center;
}

.card{
    width:50px;
    height:75px;
    background:white;
    border-radius:8px;
    display:inline-flex;
    justify-content:center;
    align-items:center;
    font-weight:bold;
    font-size:18px;
    color:black;
    margin:3px;
    box-shadow:0 5px 8px rgba(0,0,0,0.5);
    cursor:pointer;
    transition:0.2s;
}

.card:hover{
    transform:translateY(-8px);
}

.red{ color:red; }

/* Buttons */
.controls{
    position:fixed;
    bottom:20px;
    width:100%;
    text-align:center;
}

button{
    margin:5px;
    padding:10px 20px;
    border:none;
    border-radius:8px;
    font-weight:bold;
    font-size:14px;
}

.sort{ background:#2979ff; color:white; }
.drop{ background:#d50000; color:white; }
.declare{ background:#00c853; color:white; }
</style>
</head>

<body>

<div class="topbar">
<div>Coins: <span id="coins">0</span></div>
<div id="status">Waiting...</div>
</div>

<div class="table-area">
<div class="table">

<div class="deck closed">
<div class="deck-box"></div>
<div>Closed</div>
</div>

<div class="deck open">
<div class="deck-box" id="openCard">?</div>
<div>Open</div>
</div>

</div>
</div>

<div class="cards-area" id="myCards"></div>

<div class="controls">
<button class="sort" onclick="sortCards()">Sort</button>
<button class="drop" onclick="dropGame()">Drop</button>
<button class="declare" onclick="declareGame()">Declare</button>
</div>

<script>
const socket = io();
let myCards=[];
let isMyTurn=false;

document.getElementById("coins").innerText =
localStorage.getItem("coins") || 0;

socket.emit("joinGame",{
    name:localStorage.getItem("name"),
    mode:localStorage.getItem("gameMode")
});

socket.on("gameStart",(data)=>{
    myCards=data.myCards;
    document.getElementById("openCard").innerText=data.openCard;
    renderCards();
});

socket.on("updateState",(data)=>{
    isMyTurn=(data.turn===0);
    document.getElementById("status").innerText=
    "Turn: Player "+(data.turn+1);
});

socket.on("cardDrawn",(data)=>{
    myCards.push(data.card);
    renderCards();
});

socket.on("cardDiscarded",(data)=>{
    document.getElementById("openCard").innerText=data.openCard;
});

function renderCards(){
    const container=document.getElementById("myCards");
    container.innerHTML="";
    myCards.forEach((card,index)=>{
        const div=document.createElement("div");
        div.className="card";
        if(card.includes("♥")||card.includes("♦"))
            div.classList.add("red");
        div.innerText=card;
        div.onclick=()=>{
            if(!isMyTurn) return;
            discardCard(index);
        };
        container.appendChild(div);
    });
}

function discardCard(index){
    const card=myCards[index];
    myCards.splice(index,1);
    socket.emit("discardCard",{card});
    renderCards();
}

function sortCards(){
    myCards.sort();
    renderCards();
}

function dropGame(){
    socket.emit("dropGame");
}

function declareGame(){
    socket.emit("declareGame",{hand:myCards});
}
</script>

</body>
</html>
