<!DOCTYPE html>
<html>
<head>
    <title>Rummy Rex - Live Table</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <script src="/socket.io/socket.io.js"></script>
    <style>
        body { background: #073b1c; color: white; font-family: sans-serif; margin: 0; overflow: hidden; }
        .header { padding: 10px; display: flex; justify-content: space-between; background: rgba(0,0,0,0.8); border-bottom: 2px solid gold; }
        .table { width: 92vw; height: 50vh; background: radial-gradient(circle, #1a5d2d 0%, #052c1a 100%); margin: 20px auto; border-radius: 180px; border: 8px solid #5d4037; position: relative; box-shadow: inset 0 0 50px #000; }
        
        /* Player Positions */
        .player { position: absolute; width: 60px; height: 60px; background: #222; border: 2px solid gold; border-radius: 50%; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 10px; z-index: 10; }
        .p1 { bottom: -30px; left: 50%; transform: translateX(-50%); border-color: #00ff00; } /* YOU */
        .p2 { top: 50%; left: -30px; transform: translateY(-50%); }
        .p3 { top: -30px; left: 50%; transform: translateX(-50%); }
        .p4 { top: 50%; right: -30px; transform: translateY(-50%); }

        /* Score Display */
        .score { font-size: 9px; color: gold; font-weight: bold; }

        /* Cards Center */
        .center-pile { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); display: flex; gap: 15px; }
        .card { width: 45px; height: 65px; background: white; border-radius: 5px; border: 1px solid #333; color: black; font-weight: bold; display: flex; align-items: center; justify-content: center; font-size: 16px; box-shadow: 2px 2px 5px #000; cursor: pointer; }
        .deck { background: linear-gradient(135deg, #ff4444 0%, #990000 100%); color: white; border: 1px solid #fff; }

        /* User Hand */
        .hand { position: fixed; bottom: 85px; width: 100%; display: flex; justify-content: center; z-index: 20; }
        .hand-card { width: 42px; height: 62px; background: white; border-radius: 4px; border: 1px solid #000; color: black; font-weight: bold; margin-left: -12px; box-shadow: -2px 0 5px rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; font-size: 14px; transition: 0.2s; cursor: pointer; }
        .hand-card:active { transform: translateY(-20px); }

        /* Controls */
        .controls { position: fixed; bottom: 0; width: 100%; background: #000; padding: 12px; display: flex; justify-content: space-around; border-top: 1px solid gold; z-index: 30; }
        .btn { padding: 8px 18px; border-radius: 6px; border: none; font-weight: bold; color: white; cursor: pointer; font-size: 14px; }
        .btn-drop { background: #d32f2f; }
        .btn-sort { background: #1976d2; }
        .btn-declare { background: #388e3c; }
    </style>
</head>
<body>

    <div class="header">
        <div>ü™ô <span id="balanceDisplay">0</span></div>
        <div style="color: gold; font-weight: bold;">POOL 101/201</div>
        <button onclick="location.href='lobby.html'" style="background:none; color:white; border:1px solid white; padding:5px 10px; border-radius:5px;">EXIT</button>
    </div>

    <div class="table">
        <div class="player p1"><span class="score">Pts: 0</span>YOU</div>
        <div class="player p2"><span class="score">Pts: 12</span>Opp 1</div>
        <div class="player p3"><span class="score">Pts: 45</span>Opp 2</div>
        <div class="player p4"><span class="score">Pts: 08</span>Opp 3</div>

        <div class="center-pile">
            <div class="card deck" onclick="pickCard()">üé¥</div>
            <div class="card open-card" id="openCard" style="color: red;">‚ô•Ô∏èA</div>
        </div>
    </div>

    <div class="hand" id="userHand"></div>

    <div class="controls">
        <button class="btn btn-drop" onclick="location.href='lobby.html'">DROP</button>
        <button class="btn btn-sort" onclick="sortHand()">SORT</button>
        <button class="btn btn-declare" onclick="declareGame()">DECLARE</button>
    </div>

    <script>
        const socket = io();
        const userName = localStorage.getItem('name') || 'Guest';
        document.getElementById('balanceDisplay').innerText = localStorage.getItem('coins') || 0;

        // Socket Join
        socket.emit('joinGame', { name: userName });

        // Initial 13 Cards
        let myCards = ['‚ô•Ô∏èA', '‚ô†Ô∏èK', '‚ô¶Ô∏èQ', '‚ô£Ô∏èJ', '‚ô•Ô∏è10', '‚ô†Ô∏è9', '‚ô¶Ô∏è8', '‚ô£Ô∏è7', '‚ô•Ô∏è6', '‚ô†Ô∏è5', '‚ô¶Ô∏è4', '‚ô£Ô∏è3', '‚ô•Ô∏è2'];

        function renderHand() {
            const container = document.getElementById('userHand');
            container.innerHTML = '';
            myCards.forEach((card, i) => {
                const el = document.createElement('div');
                el.className = 'hand-card';
                el.style.color = (card.includes('‚ô•Ô∏è') || card.includes('‚ô¶Ô∏è')) ? 'red' : 'black';
                el.innerText = card;
                el.onclick = () => discardCard(i);
                container.appendChild(el);
            });
        }

        function pickCard() {
            if(myCards.length > 13) return alert("Card drop chey mama!");
            myHand.push('‚ô£Ô∏èA'); 
            renderHand();
        }

        function discardCard(i) {
            if(myCards.length <= 13) return alert("Mundu card pick chey!");
            const card = myCards.splice(i, 1);
            document.getElementById('openCard').innerText = card[0];
            document.getElementById('openCard').style.color = (card[0].includes('‚ô•Ô∏è') || card[0].includes('‚ô¶Ô∏è')) ? 'red' : 'black';
            renderHand();
        }

        function sortHand() {
            myCards.sort();
            renderHand();
        }

        function declareGame() {
            alert("Checking sequences... 101 Pool Points Calculated!");
        }

        renderHand();
    </script>
</body>
</html>
