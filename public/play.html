<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pro Rummy</title>
<script src="/socket.io/socket.io.js"></script>

<style>
body{
    margin:0;
    background:radial-gradient(circle at top,#3b2a1a,#0b3d2e);
    font-family:'Segoe UI',sans-serif;
    color:white;
    overflow:hidden;
}

/* ===== TOP BAR ===== */
.topbar{
    display:flex;
    justify-content:space-between;
    padding:10px 15px;
    background:#111;
    font-size:14px;
}

/* ===== TABLE ===== */
.table-wrapper{
    display:flex;
    justify-content:center;
    align-items:center;
    height:65vh;
}

.table{
    position:relative;
    width:90%;
    max-width:750px;
    height:320px;
    background:linear-gradient(145deg,#1e8449,#145a32);
    border-radius:200px;
    border:8px solid #a67c00;
    box-shadow:
        inset 0 0 40px rgba(0,0,0,0.7),
        0 0 25px rgba(255,215,0,0.3);
}

/* ===== DECKS ===== */
.deck-area{
    position:absolute;
    top:50%;
    transform:translateY(-50%);
    text-align:center;
}

.closed-deck{
    left:18%;
}

.open-deck{
    right:18%;
}

.deck-stack{
    width:60px;
    height:85px;
    background:#0d0d0d;
    border-radius:8px;
    box-shadow:0 6px 10px rgba(0,0,0,0.6);
}

.open-card{
    width:60px;
    height:85px;
    background:white;
    color:black;
    font-weight:bold;
    font-size:22px;
    display:flex;
    justify-content:center;
    align-items:center;
    border-radius:8px;
    box-shadow:0 6px 10px rgba(0,0,0,0.6);
}

/* ===== CENTER SLOT ===== */
.finish-slot{
    position:absolute;
    top:50%;
    left:50%;
    transform:translate(-50%,-50%);
    padding:15px 25px;
    background:rgba(0,0,0,0.3);
    border-radius:12px;
    font-weight:bold;
}

/* ===== CARDS BOTTOM ===== */
.cards-container{
    position:absolute;
    bottom:-55px;
    width:100%;
    text-align:center;
}

.card{
    display:inline-block;
    width:55px;
    height:80px;
    background:white;
    border-radius:10px;
    margin:4px;
    font-weight:bold;
    font-size:18px;
    color:black;
    display:inline-flex;
    align-items:center;
    justify-content:center;
    box-shadow:0 6px 10px rgba(0,0,0,0.5);
    cursor:pointer;
    transition:0.2s;
}

.card:hover{
    transform:translateY(-10px);
}

.red{ color:red; }

/* ===== BUTTONS ===== */
.controls{
    position:absolute;
    bottom:-110px;
    width:100%;
    text-align:center;
}

button{
    margin:5px;
    padding:10px 18px;
    border:none;
    border-radius:8px;
    font-weight:bold;
}

.sort{ background:#2979ff; color:white; }
.drop{ background:#d50000; color:white; }
.declare{ background:#00c853; color:white; }

/* ===== AVATAR ===== */
.avatar{
    position:absolute;
    bottom:-150px;
    left:50%;
    transform:translateX(-50%);
    width:70px;
    height:70px;
    border-radius:50%;
    background:#222;
    border:4px solid gold;
}
</style>
</head>

<body>

<div class="topbar">
<div>Coins: <span id="coins">0</span></div>
<div id="status">Deal Stage</div>
</div>

<div class="table-wrapper">
<div class="table">

<!-- CLOSED DECK -->
<div class="deck-area closed-deck">
<div class="deck-stack"></div>
<div>Closed</div>
</div>

<!-- OPEN DECK -->
<div class="deck-area open-deck">
<div class="open-card" id="openCard">?</div>
<div>Open</div>
</div>

<!-- FINISH SLOT -->
<div class="finish-slot">
FINISH SLOT
</div>

<!-- PLAYER CARDS -->
<div class="cards-container" id="myCards"></div>

<!-- BUTTONS -->
<div class="controls">
<button class="sort" onclick="sortCards()">Sort</button>
<button class="drop" onclick="dropGame()">Drop</button>
<button class="declare" onclick="declareGame()">Declare</button>
</div>

<!-- AVATAR -->
<div class="avatar"></div>

</div>
</div>

<script>
const socket = io();
let myCards=[];
let isMyTurn=false;

document.getElementById("coins").innerText =
localStorage.getItem("coins") || 0;

socket.emit("joinGame",{
    name:localStorage.getItem("name"),
    mode:localStorage.getItem("gameMode")
});

socket.on("gameStart",(data)=>{
    myCards=data.myCards;
    document.getElementById("openCard").innerText=data.openCard;
    renderCards();
});

socket.on("updateState",(data)=>{
    isMyTurn=(data.turn===0);
    document.getElementById("status").innerText=
    "Turn: Player "+(data.turn+1);
});

socket.on("cardDrawn",(data)=>{
    myCards.push(data.card);
    renderCards();
});

socket.on("cardDiscarded",(data)=>{
    document.getElementById("openCard").innerText=data.openCard;
});

function renderCards(){
    const container=document.getElementById("myCards");
    container.innerHTML="";
    myCards.forEach((card,index)=>{
        const div=document.createElement("div");
        div.className="card";
        if(card.includes("♥")||card.includes("♦"))
            div.classList.add("red");
        div.innerText=card;
        div.onclick=()=>{
            if(!isMyTurn) return;
            discardCard(index);
        };
        container.appendChild(div);
    });
}

function discardCard(index){
    const card=myCards[index];
    myCards.splice(index,1);
    socket.emit("discardCard",{card});
    renderCards();
}

function sortCards(){
    myCards.sort();
    renderCards();
}

function dropGame(){
    socket.emit("dropGame");
}

function declareGame(){
    socket.emit("declareGame",{hand:myCards});
}
</script>

</body>
    </html>
